{% extends 'base.html' %} {% load markdown %} {% block content %}

<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-8">{{ user.username }}'s Profile</h1>

  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-semibold mb-4">Profile Overview</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <h3 class="text-lg font-semibold mb-2">Personal Information</h3>
        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>First Name:</strong> {{ user.profile.first_name }}</p>
        <p><strong>Bio:</strong> {{ user.profile.bio }}</p>
      </div>

      <div>
        <h3 class="text-lg font-semibold mb-2">Progress</h3>
        <div class="mb-4">
          <div class="bg-gray-200 rounded-full h-4">
            <div
              class="bg-blue-600 rounded-full h-4"
              style="width: {{ courses_completion_percentage }}%"
            ></div>
          </div>
          <p>
            {{ courses_completion_percentage|floatformat:1 }}% of courses
            completed
          </p>
        </div>

        <h3 class="text-lg font-semibold mb-2">Watched Videos</h3>
        <p>{{ watched_videos_count }} videos watched</p>
      </div>
    </div>
  </div>

  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-semibold mb-4">Courses Enrolled</h2>

    {% if enrolled_courses %} {% for course in enrolled_courses %}
    <div class="mb-6">
      <h3 class="text-lg font-semibold">{{ course.title }}</h3>
      <p>{{ course.description|markdown_to_html|truncatewords:25 }}</p>

      <div class="mt-2">
        <div class="bg-gray-200 rounded-full h-2">
          <div
            class="bg-green-500 rounded-full h-2"
            style="width: {{ user.profile.get_course_completion_percentage|floatformat:1 }}%"
          ></div>
        </div>
        <p>
          {{ user.profile.get_course_completion_percentage|floatformat:1 }}%
          complete
        </p>
      </div>

      <div class="mt-4 flex space-x-2">
        <a
          href="{% url 'profiles:resume_course' course_id=course.public_id %}"
          class="bg-blue-500 text-white px-4 py-2 rounded"
          style="
            background-color: #000000;
            color: white;
            font: medium;
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
          "
          onmouseover="this.style.backgroundColor='#2563eb';"
          onmouseout="this.style.backgroundColor='#000000';"
          >Resume</a
        >
        <form
          action="{% url 'profiles:remove_course' course_id=course.public_id %}"
          method="post"
        >
          {% csrf_token %}
          <button
            type="submit"
            style="
              background-color: #ff0000;
              color: white;
              font: medium;
              padding: 6px 12px;
              border-radius: 4px;
              border: none;
              cursor: pointer;
              transition: background-color 0.3s;
            "
            onmouseover="this.style.backgroundColor='#2563eb';"
            onmouseout="this.style.backgroundColor='#ff0000';"
          >
            Remove Course
          </button>
        </form>
      </div>
    </div>
    {% endfor %} {% else %}
    <p>You are not enrolled in any courses yet.</p>
    {% endif %}
  </div>

  <!-- Contact Tutor -->
  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-semibold mb-4">Contact Tutor</h2>
    <form action="#" method="post" class="space-y-4">
      {% csrf_token %}
      <div>
        <label for="subject" class="block text-sm font-medium text-gray-700"
          >Subject</label
        >
        <input
          type="text"
          name="subject"
          id="subject"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
        />
      </div>
      <div>
        <label for="message" class="block text-sm font-medium text-gray-700"
          >Message</label
        >
        <textarea
          name="message"
          id="message"
          rows="4"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
        ></textarea>
      </div>
      <div>
        <button
          type="submit"
          style="
            background-color: #000000;
            color: white;
            font: medium;
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
          "
          onmouseover="this.style.backgroundColor='#2563eb';"
          onmouseout="this.style.backgroundColor='#000000';"
        >
          Send Message
        </button>
      </div>
    </form>
  </div>

  <!-- Edit Profile -->
  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-semibold mb-4">Edit Profile</h2>
    <form
      action="{% url 'profiles:edit_profile' %}"
      method="post"
      class="space-y-4"
    >
      {% csrf_token %} {{ u_form.as_p }} {{ p_form.as_p }}
      <div>
        <button
          type="submit"
          style="
            background-color: #000000;
            color: white;
            font: medium;
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
          "
          onmouseover="this.style.backgroundColor='#10b981';"
          onmouseout="this.style.backgroundColor='#000000';"
        >
          Update Profile
        </button>
      </div>
    </form>
  </div>

  <!-- Delete Account -->
  <div class="bg-white shadow rounded-lg p-6">
    <h2 class="text-2xl font-semibold mb-4 text-red-600">Delete Account</h2>
    <p class="mb-4 text-gray-700">
      Warning: This action cannot be undone. All your data will be permanently
      deleted.
    </p>
    <form
      action="{% url 'profiles:delete_account' %}"
      method="post"
      onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');"
    >
      {% csrf_token %}
      <button
        type="submit"
        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
      >
        Delete Account
      </button>
    </form>
  </div>
</div>
{% endblock %}
